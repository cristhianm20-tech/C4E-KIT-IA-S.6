**title**: "Migración build.gradle Completa – Spring Boot 2.7→3.2.x, Java 17, Gradle 8.x (CoT)"  
**date**: 2025-06-11  
**author**: "Santiago Correa"  
**tags**: [gradle, spring-boot, java17, junit5, jacoco, sonarqube, migration, chain-of-thought]

### Contexto
Este recipe utiliza **Chain-of-Thought** para migrar completamente de versión una aplicación Java con SpringBoot, como el archivo `build.gradle` y las clases propias del proyecto de Spring Boot 2.7.0 a 3.2.x, incluyendo actualización de Java 17, Gradle 8.x, JUnit 5, y herramientas de calidad de código (JaCoCo, SonarQube).

### Prompt (ES)
Eres un Senior Build Engineer y Spring Boot Migration Specialist con expertise en Gradle, Java 17, y herramientas de calidad de código.  
Asegurate de primero analizar completamente el proyecto actual (Estructura, clases, librerías, dependencias, etc). Este consta de una aplicación RESTful con servicios CRUD básicos de una tabla de usuarios y una base de datos H2 en memoria.
Razona paso a paso cómo migrarías completamente el **build.gradle y las clases del proyecto** de este proyecto de Spring Boot 2.7.0 a 3.2.x, asegurate de responder siempre en español:

**Dependencias actuales a migrar:**
- spring-boot-starter-web
- spring-boot-starter-data-jpa  
- h2database 1.4.200
- junit 4.13.2
- jmh-core 1.21

**Requisitos de migración:**
1. Migrar a Spring Boot 3.2.x con compatibilidad Java 17
2. Actualizar Gradle wrapper a versión recomendada (8.x)
3. Migrar JUnit 4.13.2 → JUnit 5 Jupiter completo
4. Integrar spring-boot-starter-validation para javax→jakarta
5. Actualizar H2 Database a versión compatible con Spring Boot 3.x
6. Mantener JMH (Java Microbenchmark Harness) para performance testing
7. Configurar JaCoCo para cobertura de código ≥85%
8. Integrar SonarQube 4.x con quality gates
9. Agregar la librería de lombok para simplificar el código
10. No usar Sping Security ni Spring Cloud
11. Agregar librería de Mockito para pruebas unitarias
12. Conservar los parámetros de configuración de sonarqube
13. Las pruebas unitarias deben seguir pasando sin errores y usar solo JUnit 5 con Mockito
14. Las validaciones de Jakarta deben ser usadas solo en los DTOs o Controllers
15. Asegurarse que la versión de Java sea 17 para el proyecto
16. Primero deben migrarse las pruebas unitarias y de integración, y luego el código
17. Asegurarse que el proyecto compile y funcione correctamente después de la migración
18. Debe mantenerse la misma lógica de negocio y estructura del proyecto a excepción de las actualizaciones necesarias
19. No se deben introducir nuevas dependencias que no estén en la lista
20. Ejecutar la totalidad del proyecto una vez migrado para verificar que todo funcione correctamente

**Proceso de migración paso a paso:**

1. **Análisis de Compatibilidad de Versiones**  
   - Verificar matriz de compatibilidad Spring Boot 3.2.x + Java 17 + Gradle 8.x  
   - Identificar versiones específicas de cada dependencia compatible  
   - Mapear breaking changes en APIs de dependencias  
   - Evaluar impact en build scripts existentes

2. **Actualización de Gradle Wrapper y Plugins**  
   - Actualizar gradle-wrapper.properties a versión 8.5+  
   - Migrar plugins a versiones compatibles con Gradle 8.x  
   - Configurar Java Toolchain para Java 17  
   - Actualizar syntax deprecated en build scripts

3. **Migración de Spring Boot Core Dependencies**  
   - Actualizar spring-boot plugin a 3.2.x  
   - Migrar spring-boot-starter-web con cambios javax→jakarta  
   - Actualizar spring-boot-starter-data-jpa con Hibernate 6.x  
   - Configurar dependency management para BOM consistency

4. **Migración Completa JUnit 4 → JUnit 5**  
   - Remover junit:junit 4.13.2 completamente  
   - Agregar junit-jupiter-engine, junit-jupiter-api, junit-jupiter-params  
   - Configurar test platform para Jupiter execution  
   - Actualizar configuración de test logging y reporting

5. **Integración de Nuevas Dependencias Requeridas**  
   - Agregar spring-boot-starter-validation para Bean Validation 3.0  
   - Adicionar validation annotations compatibility
   - Agregar lombok para simplificar código compatible con Java 17
   - Agregar Mockito para pruebas unitarias compatibles con JUnit 5
   - Hacer la importación de las nuevas dependencias en el build.gradle

6. **Actualización de Base de Datos H2**  
   - Migrar H2 1.4.200 → versión 2.2.x compatible  
   - Configurar H2 database compatibility mode  
   - Actualizar connection settings para nueva versión  
   - Verificar SQL compatibility con Hibernate 6.x

7. **Actualización de las clases del proyecto**  
   - Migrar clases de test a JUnit 5 con Mockito  
   - Actualizar anotaciones de test y assertions  
   - Verificar compatibilidad de DTOs y Controllers con Jakarta  
   - Asegurar que las validaciones se apliquen correctamente
   - Asegurar se usen solo las validaciones de Jakarta en DTOs y Controllers
   - Mantener lógica de negocio y estructura del proyecto modificando las partes necesarias según la versión a actualizar
   - Modificar las malas prácticas de código y las dependencias que no se usen

8. **Configuración de JMH para Performance Testing**  
   - Actualizar jmh-core a versión compatible con Java 17  
   - Agregar jmh-generator-annprocess para annotation processing  
   - Configurar JMH plugin para benchmarking integration  
   - Separar performance tests de unit tests

9. **Integración de JaCoCo para Code Coverage**  
   - Configurar jacoco plugin con versión 0.8.11+  
   - Establecer coverage thresholds (≥85% line coverage)  
   - Configurar exclusions para generated code  
   - Integrar con test execution y reporting

10. **Configuración de SonarQube 4.x Quality Gates**  
   - Integrar sonarqube plugin 4.x  
   - Configurar quality profiles y quality gates  
   - Establecer coverage integration con JaCoCo  
   - Configurar analysis properties y exclusions

11. **Security y Dependency Management**  
    - Integrar OWASP dependency-check plugin  
    - Configurar CVE vulnerability scanning  
    - Establecer dependency resolution strategy  
    - Configurar security reporting y thresholds
    - No implementar Spring Security ni Spring Cloud
    
12. **Actualización de pruebas unitarias con JUnit 5 y Mockito**  
    - Migrar todas las pruebas unitarias a JUnit 5 con Mockito  
    - Asegurar que todas las pruebas unitarias pasen sin errores  
    - Verificar que las validaciones de Jakarta se apliquen correctamente en los DTOs y Controllers  
    - Asegurar que la lógica de negocio se mantenga intacta

**Entrega el build.gradle completo migrado y clases y pruebas modificadas:**

### **BUILD.GRADLE MIGRADO COMPLETO Y CLASES MODIFICADAS**

```gradle
// ================================================================================================
// SPRING BOOT 3.2.x MIGRATION - COMPLETE BUILD.GRADLE
// Migrated from: Spring Boot 2.7.0 + Java 11 + JUnit 4
// Migrated to: Spring Boot 3.2.0 + Java 17 + JUnit 5 + Quality Tools
// ================================================================================================

plugins {
    id 'java'
    id 'org.springframework.boot' version '3.2.0'                    // UPDATED: 2.7.0 → 3.2.0
    id 'io.spring.dependency-management' version '1.1.4'            // UPDATED: Latest compatible
    id 'jacoco'                                                      // NEW: Code coverage
    id 'org.sonarqube' version '4.4.1.3373'                        // NEW: Quality gates
    id 'org.owasp.dependencycheck' version '9.0.7'                 // NEW: Security scanning
    id 'me.champeau.jmh' version '0.7.2'                           // NEW: JMH integration
}

group = 'com.example'
version = '1.0.0'

// ================================================================================================
// JAVA 17 CONFIGURATION
// ================================================================================================
java {
    sourceCompatibility = '17'                                      // UPDATED: 11 → 17
    targetCompatibility = '17'                                      // UPDATED: 11 → 17
    toolchain {
        languageVersion = JavaLanguageVersion.of(17)                // NEW: Java Toolchain
    }
}

// ================================================================================================
// REPOSITORIES
// ================================================================================================
repositories {
    mavenCentral()
    gradlePluginPortal()                                            // NEW: For plugins
}

// ================================================================================================
// DEPENDENCY MANAGEMENT
// ================================================================================================
dependencyManagement {
    imports {
        mavenBom "org.springframework.boot:spring-boot-dependencies:3.2.0"
        mavenBom "org.junit:junit-bom:5.10.1"                      // NEW: JUnit 5 BOM
    }
}

// ================================================================================================
// DEPENDENCIES
// ================================================================================================
dependencies {
    // SPRING BOOT STARTERS - UPDATED TO 3.2.x
    implementation 'org.springframework.boot:spring-boot-starter-web'              // javax → jakarta
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'        // Hibernate 6.x
    implementation 'org.springframework.boot:spring-boot-starter-validation'      // NEW: Bean Validation 3.0
    implementation 'org.springframework.boot:spring-boot-starter-actuator'        // NEW: Monitoring
    
    // DATABASE
    runtimeOnly 'com.h2database:h2:2.2.224'                                      // UPDATED: 1.4.200 → 2.2.224
    
    // PERFORMANCE TESTING - JMH
    jmhImplementation 'org.openjdk.jmh:jmh-core:1.37'                           // UPDATED: 1.21 → 1.37
    jmhAnnotationProcessor 'org.openjdk.jmh:jmh-generator-annprocess:1.37'      // NEW: Annotation processing
    
    // TESTING - MIGRATED TO JUNIT 5
    testImplementation 'org.springframework.boot:spring-boot-starter-test'        // Includes JUnit 5
    testImplementation 'org.junit.jupiter:junit-jupiter-engine'                  // NEW: Jupiter engine
    testImplementation 'org.junit.jupiter:junit-jupiter-params'                  // NEW: Parameterized tests
    testImplementation 'org.mockito:mockito-junit-jupiter'                       // NEW: Mockito + Jupiter
    testImplementation 'org.assertj:assertj-core'                                // Enhanced assertions
    testImplementation 'org.testcontainers:junit-jupiter'                        // NEW: Integration testing
    testImplementation 'org.testcontainers:h2'                                   // NEW: H2 testcontainers
    
    // REMOVED: junit:junit:4.13.2 - COMPLETELY MIGRATED TO JUNIT 5
}

// ================================================================================================
// TESTING CONFIGURATION
// ================================================================================================
test {
    useJUnitPlatform()                                                           // NEW: JUnit 5 platform
    
    // Test execution configuration
    testLogging {
        events "passed", "skipped", "failed"
        exceptionFormat "full"
        showStandardStreams = false
    }
    
    // JVM arguments for testing
    jvmArgs = [
        '-Xmx2g',
        '-XX:+UseG1GC'
    ]
    
    // Coverage integration
    finalizedBy jacocoTestReport
}

// ================================================================================================
// JACOCO CONFIGURATION - CODE COVERAGE
// ================================================================================================
jacoco {
    toolVersion = "0.8.11"                                                      // Latest version
}

jacocoTestReport {
    dependsOn test
    
    reports {
        xml.required = true                                                      // For SonarQube
        csv.required = false
        html.required = true
    }
    
    // Exclude generated code
    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it, exclude: [
                '**/config/**',
                '**/dto/**',
                '**/entity/**',
                '**/*Application*',
                '**/*Config*'
            ])
        }))
    }
    
    finalizedBy jacocoTestCoverageVerification
}

jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = 0.85                                                   // 85% minimum coverage
            }
        }
        
        rule {
            enabled = true
            element = 'CLASS'
            limit {
                counter = 'LINE'
                value = 'COVEREDRATIO'
                minimum = 0.80                                                   // 80% per class
            }
        }
    }
}

// ================================================================================================
// JMH CONFIGURATION - PERFORMANCE TESTING
// ================================================================================================
jmh {
    iterations = 10
    batchSize = 1
    fork = 2
    warmupIterations = 5
    
    // Output configuration
    resultsFile = project.file("${buildDir}/reports/jmh/results.txt")
    humanOutputFile = project.file("${buildDir}/reports/jmh/human.txt")
    
    // JVM arguments for benchmarks
    jvmArgs = ['-Xmx4g', '-XX:+UseG1GC']
}

// ================================================================================================
// SONARQUBE CONFIGURATION
// ================================================================================================
sonarqube {
    properties {
        property "sonar.projectKey", "spring-boot-migration-project"
        property "sonar.projectName", "Spring Boot Migration Project"
        property "sonar.projectVersion", project.version
        
        // Coverage configuration
        property "sonar.coverage.jacoco.xmlReportPaths", "${buildDir}/reports/jacoco/test/jacocoTestReport.xml"
        property "sonar.junit.reportPaths", "${buildDir}/test-results/test"
        
        // Quality gates
        property "sonar.qualitygate.wait", "true"
        property "sonar.coverage.exclusions", [
            "**/config/**",
            "**/dto/**",
            "**/entity/**",
            "**/*Application*",
            "**/*Config*"
        ].join(",")
        
        // Code analysis
        property "sonar.java.source", "17"
        property "sonar.java.target", "17"
        property "sonar.java.binaries", "${buildDir}/classes"
    }
}

// ================================================================================================
// OWASP DEPENDENCY CHECK - SECURITY SCANNING
// ================================================================================================
dependencyCheck {
    // Report configuration
    formats = ['HTML', 'XML', 'JSON']
    
    // Vulnerability database
    cveValidForHours = 24
    
    // Fail build on CVSS score
    failBuildOnCVSS = 7.0
    
    // Suppression file for false positives
    suppressionFile = "${projectDir}/config/dependency-check-suppressions.xml"
    
    // Analysis configuration
    analyzers {
        experimentalEnabled = false
        archiveEnabled = false
        jarEnabled = true
        centralEnabled = true
    }
}

// ================================================================================================
// GRADLE WRAPPER CONFIGURATION
// ================================================================================================
wrapper {
    gradleVersion = '8.5'                                                        // UPDATED: Latest stable
    distributionType = Wrapper.DistributionType.BIN
}

// ================================================================================================
// CUSTOM TASKS
// ================================================================================================

// Full quality check task
task qualityCheck {
    dependsOn test, jacocoTestReport, jacocoTestCoverageVerification, dependencyCheckAnalyze
    description = 'Runs all quality checks: tests, coverage, security'
    group = 'verification'
}

// Pre-commit hook task
task preCommit {
    dependsOn clean, compileJava, compileTestJava, test, jacocoTestCoverageVerification
    description = 'Runs pre-commit checks'
    group = 'verification'
}

// Performance benchmark task
task benchmark {
    dependsOn jmh
    description = 'Runs JMH performance benchmarks'
    group = 'verification'
}

// ================================================================================================
// BUILD LIFECYCLE HOOKS
// ================================================================================================
build.dependsOn qualityCheck

// ================================================================================================
// MIGRATION VALIDATION COMMANDS
// ================================================================================================
/*
MIGRATION VALIDATION COMMANDS:

1. Update Gradle wrapper:
   ./gradlew wrapper --gradle-version 8.5

2. Clean build verification:
   ./gradlew clean build

3. Run all tests:
   ./gradlew test

4. Generate coverage report:
   ./gradlew jacocoTestReport

5. Run security scan:
   ./gradlew dependencyCheckAnalyze

6. Run SonarQube analysis:
   ./gradlew sonarqube -Dsonar.host.url=http://localhost:9000

7. Run performance benchmarks:
   ./gradlew jmh

8. Complete quality check:
   ./gradlew qualityCheck

POST-MIGRATION CHECKLIST:
□ Application starts without errors
□ All endpoints respond correctly  
□ Database migrations successful
□ Tests pass with >85% coverage
□ Security scan shows no critical vulnerabilities
□ SonarQube quality gates pass
□ Performance benchmarks complete
*/
```

### **ARCHIVOS ADICIONALES REQUERIDOS**

**gradle/wrapper/gradle-wrapper.properties:**
```properties
distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-8.5-bin.zip
networkTimeout=10000
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists
```

**config/dependency-check-suppressions.xml:**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<suppressions xmlns="https://jeremylong.github.io/DependencyCheck/dependency-suppression.1.3.xsd">
    <!-- Suppress false positives here -->
</suppressions>
```

### **RESUMEN DE CAMBIOS REALIZADOS**

| Componente | Versión Anterior | Versión Nueva | Cambios Principales |
|------------|------------------|---------------|-------------------|
| Spring Boot | 2.7.0 | 3.2.0 | javax→jakarta, Hibernate 6.x |
| Java | 11 | 17 | Toolchain, nuevas features |
| Gradle | 7.x | 8.5 | Wrapper actualizado |
| JUnit | 4.13.2 | 5.10.1 | Migración completa a Jupiter |
| H2 Database | 1.4.200 | 2.2.224 | Compatibilidad Spring Boot 3.x |
| JMH | 1.21 | 1.37 | Java 17 compatibility |